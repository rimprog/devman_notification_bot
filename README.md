# Телеграм бот для уведомлений о проверенных уроках на Devman

При запуске скрипта, реализуя метод [long polling](https://dvmn.org/encyclopedia/about-chatbots/long-polling/) происходит опрашивание API [девмана](https://dvmn.org/) на предмет наличия новых проверенных работ. Если приходит проверенная новая работа, то в телеграм приходит сообщение по типу:
```
У вас проверили работу "Делаем игру про космос".
Ссылка на работу: https://dvmn.org/modules/async-python/lesson/async-console-game/
К сожалению в работе нашлись ошибки. Исправьте их и отправьте работу на проверку снова.
```
Также в работе бота предусмотрены обработки ошибок, возникающих при потери связи с интернетом или превышение времени допустимого ожидания ответа от сервера. При возникновении данных ошибок бот выведет информацию о возникшей ошибки в телеграм и взяв перерыв в 100 секунд продолжит свою работу.

## Переменные окружения

Необходимые для корректной работы бота токены беруться из переменных окружения. Чтобы их определить, создайте файл `.env` рядом с `main.py` и запишите туда данные в таком формате: `ПЕРЕМЕННАЯ=значение`.

Важно определить следующие 3 переменные:
- `TELEGRAM_BOT_TOKEN` — токен вашего телеграм бота, куда будут выводиться уведомления о проверенных работах. Создать нового телеграм бота и получить токен можно у [BotFather](https://telegram.me/BotFather).
- `TELEGRAM_USER_ID` — id пользователя, кому бот будет присылать уведомление о проверенных работах. Получить свой id можно у [этого телеграм бота](https://telegram.me/userinfobot).
- `DVMN_API_TOKEN` — ваш API TOKEN на DEVMAN. Получить можно [ЗДЕСЬ](https://dvmn.org/api/docs/) в разделе "Аутентификация".

## Как запустить

- Для запуска сайта вам понадобится Python третьей версии.
- Скачайте репозиторий с кодом и прилегающими файлами.
- Установите зависимости командой `pip install -r requirements.txt`.
- Убедитесь что вы создали и наполнили файл `.env` по инструкции разделом выше.
- Запустите скрипт командой `python3 main.py`.

В случае успешного запуска скрипта, в консоль будет выведено следующее сообщение:
`Waiting new lesson review...`

## Как запустить бота при помощи docker

- Убедитесь что у вас установлен docker. Про [установку docker](https://docs.docker.com/get-docker/).
- Соберите докер образ текущего проекта запустив команду `docker build --tag devman_notification_bot .`. Подробнее про [docker build images](https://docs.docker.com/language/python/build-images/).
- Через команду `docker run -d --env-file ./.env --name devman_notification devman_notification_bot` запустите докер контейнер на основе собранного ранее образа проекта.
- В случае успешного запуска докер контейнера, в телеграм придет следующее сообщение: `Bot started. Waiting new lesson review...`
- Для остановки работы контейнера используйте команду `docker stop CONTAINER_ID`. Узнать CONTAINER_ID можно выполнив команду `docker ps`. [Подробнее про run containers](https://docs.docker.com/language/python/run-containers/).

## Как задеплоить бота на Heroku

- Скопируйте себе на github [репозиторий проекта](https://github.com/rimprog/devman_notification_bot).
- Зарегистрируйтесь и перейдите в раздел apps на сайте [Heroku](https://dashboard.heroku.com/apps).
- Нажмите кнопку `NEW`, а затем в выпадающем меню нажмите `Create new app`. Вы попадете на [страницу](https://dashboard.heroku.com/new-app) создания нового приложения.
- Заполните все необходимые данные и нажмите кнопку `Create app`.
- Откройте созданное приложение и перейдите в раздел `Deploy`.
- В подразделе `Deployment method` выберите свой скопированный `GitHub` репозиторий проекта и подключите его.
- Перейдите в подраздел `Manual deploy` и выбрав нужную ветку, нажмите кнопку `Deploy Branch`.
- Выше приложение готово к работе. Если приложение по какой-то причине не запустилось, проверьте [логи](https://devcenter.heroku.com/articles/logging#view-logs) вашего приложения и устраните указаннную ошибку.

## Как задеплоить бота в docker на Heroku

- Установите [Heroku CLI](https://devcenter.heroku.com/articles/heroku-command-line).
- Залогиньтесь в heroku cli через команду `heroku login`.
- Создайте новое приложение командой `heroku create -a devman-notification-docker-app`.
- Через [графическое меню heroku](https://dashboard.heroku.com/apps/) откройте созданное приложение и в settings добавьте переменные окружения `.env` в `Config Vars`
- Установите созданному приложению stack container, выполнив команду `heroku stack:set container`
- Отправьте код текущего репозитория на heroku, выполнив команду `git push heroku master`.
- Heroku автоматически создаст и запустит docker container, используя переменные окружения из `Config Vars`.

## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).
